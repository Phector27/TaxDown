43ede9d5a231300821a5184ee3312ffc
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _ModalInjection = _interopRequireDefault(require("./ModalInjection"));

var _NativeEventEmitter = _interopRequireDefault(require("../EventEmitter/NativeEventEmitter"));

var _NativeModalManager = _interopRequireDefault(require("./NativeModalManager"));

var _VirtualizedListContext = require("../Lists/VirtualizedListContext.js");

var _RCTModalHostViewNativeComponent = _interopRequireDefault(require("./RCTModalHostViewNativeComponent"));

var _container, _ModalInjection$unsta;

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

var AppContainer = require('../ReactNative/AppContainer');

var I18nManager = require('../ReactNative/I18nManager');

var Platform = require('../Utilities/Platform');

var React = require('react');

var ScrollView = require('../Components/ScrollView/ScrollView');

var StyleSheet = require('../StyleSheet/StyleSheet');

var View = require('../Components/View/View');

var _require = require('../ReactNative/RootTag'),
    RootTagContext = _require.RootTagContext;

var ModalEventEmitter = Platform.OS === 'ios' && _NativeModalManager.default != null ? new _NativeEventEmitter.default(Platform.OS !== 'ios' ? null : _NativeModalManager.default) : null;
var uniqueModalIdentifier = 0;

function confirmProps(props) {
  if (__DEV__) {
    if (props.presentationStyle && props.presentationStyle !== 'overFullScreen' && props.transparent === true) {
      console.warn("Modal with '" + props.presentationStyle + "' presentation style and 'transparent' value is not supported.");
    }
  }
}

var Modal = function (_React$Component) {
  (0, _inherits2.default)(Modal, _React$Component);

  var _super = _createSuper(Modal);

  function Modal(props) {
    var _this;

    (0, _classCallCheck2.default)(this, Modal);
    _this = _super.call(this, props);

    if (__DEV__) {
      confirmProps(props);
    }

    _this._identifier = uniqueModalIdentifier++;
    return _this;
  }

  (0, _createClass2.default)(Modal, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      var _this2 = this;

      if (ModalEventEmitter) {
        this._eventSubscription = ModalEventEmitter.addListener('modalDismissed', function (event) {
          if (event.modalID === _this2._identifier && _this2.props.onDismiss) {
            _this2.props.onDismiss();
          }
        });
      }
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      if (this._eventSubscription) {
        this._eventSubscription.remove();
      }
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      if (__DEV__) {
        confirmProps(this.props);
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this3 = this;

      if (this.props.visible !== true) {
        return null;
      }

      var containerStyles = {
        backgroundColor: this.props.transparent === true ? 'transparent' : 'white'
      };
      var animationType = this.props.animationType || 'none';
      var presentationStyle = this.props.presentationStyle;

      if (!presentationStyle) {
        presentationStyle = 'fullScreen';

        if (this.props.transparent === true) {
          presentationStyle = 'overFullScreen';
        }
      }

      var innerChildren = __DEV__ ? React.createElement(AppContainer, {
        rootTag: this.context
      }, this.props.children) : this.props.children;
      return React.createElement(_RCTModalHostViewNativeComponent.default, {
        animationType: animationType,
        presentationStyle: presentationStyle,
        transparent: this.props.transparent,
        hardwareAccelerated: this.props.hardwareAccelerated,
        onRequestClose: this.props.onRequestClose,
        onShow: this.props.onShow,
        onDismiss: function onDismiss() {
          if (_this3.props.onDismiss) {
            _this3.props.onDismiss();
          }
        },
        visible: this.props.visible,
        statusBarTranslucent: this.props.statusBarTranslucent,
        identifier: this._identifier,
        style: styles.modal,
        onStartShouldSetResponder: this._shouldSetResponder,
        supportedOrientations: this.props.supportedOrientations,
        onOrientationChange: this.props.onOrientationChange,
        testID: this.props.testID
      }, React.createElement(_VirtualizedListContext.VirtualizedListContextResetter, null, React.createElement(ScrollView.Context.Provider, {
        value: null
      }, React.createElement(View, {
        style: [styles.container, containerStyles],
        collapsable: false
      }, innerChildren))));
    }
  }, {
    key: "_shouldSetResponder",
    value: function _shouldSetResponder() {
      return true;
    }
  }]);
  return Modal;
}(React.Component);

Modal.defaultProps = {
  visible: true,
  hardwareAccelerated: false
};
Modal.contextType = RootTagContext;
var side = I18nManager.getConstants().isRTL ? 'right' : 'left';
var styles = StyleSheet.create({
  modal: {
    position: 'absolute'
  },
  container: (_container = {}, (0, _defineProperty2.default)(_container, side, 0), (0, _defineProperty2.default)(_container, "top", 0), (0, _defineProperty2.default)(_container, "flex", 1), _container)
});
var ExportedModal = (_ModalInjection$unsta = _ModalInjection.default.unstable_Modal) != null ? _ModalInjection$unsta : Modal;
module.exports = ExportedModal;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJBcHBDb250YWluZXIiLCJyZXF1aXJlIiwiSTE4bk1hbmFnZXIiLCJQbGF0Zm9ybSIsIlJlYWN0IiwiU2Nyb2xsVmlldyIsIlN0eWxlU2hlZXQiLCJWaWV3IiwiUm9vdFRhZ0NvbnRleHQiLCJNb2RhbEV2ZW50RW1pdHRlciIsIk9TIiwiTmF0aXZlTW9kYWxNYW5hZ2VyIiwiTmF0aXZlRXZlbnRFbWl0dGVyIiwidW5pcXVlTW9kYWxJZGVudGlmaWVyIiwiY29uZmlybVByb3BzIiwicHJvcHMiLCJfX0RFVl9fIiwicHJlc2VudGF0aW9uU3R5bGUiLCJ0cmFuc3BhcmVudCIsImNvbnNvbGUiLCJ3YXJuIiwiTW9kYWwiLCJfaWRlbnRpZmllciIsIl9ldmVudFN1YnNjcmlwdGlvbiIsImFkZExpc3RlbmVyIiwiZXZlbnQiLCJtb2RhbElEIiwib25EaXNtaXNzIiwicmVtb3ZlIiwidmlzaWJsZSIsImNvbnRhaW5lclN0eWxlcyIsImJhY2tncm91bmRDb2xvciIsImFuaW1hdGlvblR5cGUiLCJpbm5lckNoaWxkcmVuIiwiY29udGV4dCIsImNoaWxkcmVuIiwiaGFyZHdhcmVBY2NlbGVyYXRlZCIsIm9uUmVxdWVzdENsb3NlIiwib25TaG93Iiwic3RhdHVzQmFyVHJhbnNsdWNlbnQiLCJzdHlsZXMiLCJtb2RhbCIsIl9zaG91bGRTZXRSZXNwb25kZXIiLCJzdXBwb3J0ZWRPcmllbnRhdGlvbnMiLCJvbk9yaWVudGF0aW9uQ2hhbmdlIiwidGVzdElEIiwiY29udGFpbmVyIiwiQ29tcG9uZW50IiwiZGVmYXVsdFByb3BzIiwiY29udGV4dFR5cGUiLCJzaWRlIiwiZ2V0Q29uc3RhbnRzIiwiaXNSVEwiLCJjcmVhdGUiLCJwb3NpdGlvbiIsIkV4cG9ydGVkTW9kYWwiLCJNb2RhbEluamVjdGlvbiIsInVuc3RhYmxlX01vZGFsIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIk1vZGFsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBNZXRhIFBsYXRmb3JtcywgSW5jLiBhbmQgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZm9ybWF0XG4gKiBAZmxvdyBzdHJpY3QtbG9jYWxcbiAqL1xuXG5jb25zdCBBcHBDb250YWluZXIgPSByZXF1aXJlKCcuLi9SZWFjdE5hdGl2ZS9BcHBDb250YWluZXInKTtcbmNvbnN0IEkxOG5NYW5hZ2VyID0gcmVxdWlyZSgnLi4vUmVhY3ROYXRpdmUvSTE4bk1hbmFnZXInKTtcbmltcG9ydCBNb2RhbEluamVjdGlvbiBmcm9tICcuL01vZGFsSW5qZWN0aW9uJztcbmltcG9ydCBOYXRpdmVFdmVudEVtaXR0ZXIgZnJvbSAnLi4vRXZlbnRFbWl0dGVyL05hdGl2ZUV2ZW50RW1pdHRlcic7XG5pbXBvcnQgTmF0aXZlTW9kYWxNYW5hZ2VyIGZyb20gJy4vTmF0aXZlTW9kYWxNYW5hZ2VyJztcbmNvbnN0IFBsYXRmb3JtID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL1BsYXRmb3JtJyk7XG5jb25zdCBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5jb25zdCBTY3JvbGxWaWV3ID0gcmVxdWlyZSgnLi4vQ29tcG9uZW50cy9TY3JvbGxWaWV3L1Njcm9sbFZpZXcnKTtcbmNvbnN0IFN0eWxlU2hlZXQgPSByZXF1aXJlKCcuLi9TdHlsZVNoZWV0L1N0eWxlU2hlZXQnKTtcbmNvbnN0IFZpZXcgPSByZXF1aXJlKCcuLi9Db21wb25lbnRzL1ZpZXcvVmlldycpO1xuXG5jb25zdCB7Um9vdFRhZ0NvbnRleHR9ID0gcmVxdWlyZSgnLi4vUmVhY3ROYXRpdmUvUm9vdFRhZycpO1xuXG5pbXBvcnQgdHlwZSB7Vmlld1Byb3BzfSBmcm9tICcuLi9Db21wb25lbnRzL1ZpZXcvVmlld1Byb3BUeXBlcyc7XG5pbXBvcnQge1ZpcnR1YWxpemVkTGlzdENvbnRleHRSZXNldHRlcn0gZnJvbSAnLi4vTGlzdHMvVmlydHVhbGl6ZWRMaXN0Q29udGV4dC5qcyc7XG5pbXBvcnQgdHlwZSB7Um9vdFRhZ30gZnJvbSAnLi4vUmVhY3ROYXRpdmUvUm9vdFRhZyc7XG5pbXBvcnQgdHlwZSB7RGlyZWN0RXZlbnRIYW5kbGVyfSBmcm9tICcuLi9UeXBlcy9Db2RlZ2VuVHlwZXMnO1xuaW1wb3J0IHt0eXBlIEV2ZW50U3Vic2NyaXB0aW9ufSBmcm9tICcuLi92ZW5kb3IvZW1pdHRlci9FdmVudEVtaXR0ZXInO1xuaW1wb3J0IFJDVE1vZGFsSG9zdFZpZXcgZnJvbSAnLi9SQ1RNb2RhbEhvc3RWaWV3TmF0aXZlQ29tcG9uZW50JztcblxudHlwZSBNb2RhbEV2ZW50RGVmaW5pdGlvbnMgPSB7XG4gIG1vZGFsRGlzbWlzc2VkOiBbe21vZGFsSUQ6IG51bWJlcn1dLFxufTtcblxuY29uc3QgTW9kYWxFdmVudEVtaXR0ZXIgPVxuICBQbGF0Zm9ybS5PUyA9PT0gJ2lvcycgJiYgTmF0aXZlTW9kYWxNYW5hZ2VyICE9IG51bGxcbiAgICA/IG5ldyBOYXRpdmVFdmVudEVtaXR0ZXI8TW9kYWxFdmVudERlZmluaXRpb25zPihcbiAgICAgICAgLy8gVDg4NzE1MDYzOiBOYXRpdmVFdmVudEVtaXR0ZXIgb25seSB1c2VkIHRoaXMgcGFyYW1ldGVyIG9uIGlPUy4gTm93IGl0IHVzZXMgaXQgb24gYWxsIHBsYXRmb3Jtcywgc28gdGhpcyBjb2RlIHdhcyBtb2RpZmllZCBhdXRvbWF0aWNhbGx5IHRvIHByZXNlcnZlIGl0cyBiZWhhdmlvclxuICAgICAgICAvLyBJZiB5b3Ugd2FudCB0byB1c2UgdGhlIG5hdGl2ZSBtb2R1bGUgb24gb3RoZXIgcGxhdGZvcm1zLCBwbGVhc2UgcmVtb3ZlIHRoaXMgY29uZGl0aW9uIGFuZCB0ZXN0IGl0cyBiZWhhdmlvclxuICAgICAgICBQbGF0Zm9ybS5PUyAhPT0gJ2lvcycgPyBudWxsIDogTmF0aXZlTW9kYWxNYW5hZ2VyLFxuICAgICAgKVxuICAgIDogbnVsbDtcblxuLyoqXG4gKiBUaGUgTW9kYWwgY29tcG9uZW50IGlzIGEgc2ltcGxlIHdheSB0byBwcmVzZW50IGNvbnRlbnQgYWJvdmUgYW4gZW5jbG9zaW5nIHZpZXcuXG4gKlxuICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvbW9kYWxcbiAqL1xuXG4vLyBJbiBvcmRlciB0byByb3V0ZSBvbkRpc21pc3MgY2FsbGJhY2tzLCB3ZSBuZWVkIHRvIHVuaXF1ZWx5IGlkZW50aWZpZXIgZWFjaFxuLy8gPE1vZGFsPiBvbiBzY3JlZW4uIFRoZXJlIGNhbiBiZSBkaWZmZXJlbnQgb25lcywgZWl0aGVyIG5lc3RlZCBvciBhcyBzaWJsaW5ncy5cbi8vIFdlIGNhbm5vdCBwYXNzIHRoZSBvbkRpc21pc3MgY2FsbGJhY2sgdG8gbmF0aXZlIGFzIHRoZSB2aWV3IHdpbGwgYmVcbi8vIGRlc3Ryb3llZCBiZWZvcmUgdGhlIGNhbGxiYWNrIGlzIGZpcmVkLlxubGV0IHVuaXF1ZU1vZGFsSWRlbnRpZmllciA9IDA7XG5cbnR5cGUgT3JpZW50YXRpb25DaGFuZ2VFdmVudCA9ICRSZWFkT25seTx7fFxuICBvcmllbnRhdGlvbjogJ3BvcnRyYWl0JyB8ICdsYW5kc2NhcGUnLFxufH0+O1xuXG5leHBvcnQgdHlwZSBQcm9wcyA9ICRSZWFkT25seTx7fFxuICAuLi5WaWV3UHJvcHMsXG5cbiAgLyoqXG4gICAqIFRoZSBgYW5pbWF0aW9uVHlwZWAgcHJvcCBjb250cm9scyBob3cgdGhlIG1vZGFsIGFuaW1hdGVzLlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9tb2RhbCNhbmltYXRpb250eXBlXG4gICAqL1xuICBhbmltYXRpb25UeXBlPzogPygnbm9uZScgfCAnc2xpZGUnIHwgJ2ZhZGUnKSxcblxuICAvKipcbiAgICogVGhlIGBwcmVzZW50YXRpb25TdHlsZWAgcHJvcCBjb250cm9scyBob3cgdGhlIG1vZGFsIGFwcGVhcnMuXG4gICAqXG4gICAqIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL21vZGFsI3ByZXNlbnRhdGlvbnN0eWxlXG4gICAqL1xuICBwcmVzZW50YXRpb25TdHlsZT86ID8oXG4gICAgfCAnZnVsbFNjcmVlbidcbiAgICB8ICdwYWdlU2hlZXQnXG4gICAgfCAnZm9ybVNoZWV0J1xuICAgIHwgJ292ZXJGdWxsU2NyZWVuJ1xuICApLFxuXG4gIC8qKlxuICAgKiBUaGUgYHRyYW5zcGFyZW50YCBwcm9wIGRldGVybWluZXMgd2hldGhlciB5b3VyIG1vZGFsIHdpbGwgZmlsbCB0aGVcbiAgICogZW50aXJlIHZpZXcuXG4gICAqXG4gICAqIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL21vZGFsI3RyYW5zcGFyZW50XG4gICAqL1xuICB0cmFuc3BhcmVudD86ID9ib29sZWFuLFxuXG4gIC8qKlxuICAgKiBUaGUgYHN0YXR1c0JhclRyYW5zbHVjZW50YCBwcm9wIGRldGVybWluZXMgd2hldGhlciB5b3VyIG1vZGFsIHNob3VsZCBnbyB1bmRlclxuICAgKiB0aGUgc3lzdGVtIHN0YXR1c2Jhci5cbiAgICpcbiAgICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvbW9kYWwjdHJhbnNwYXJlbnRcbiAgICovXG4gIHN0YXR1c0JhclRyYW5zbHVjZW50PzogP2Jvb2xlYW4sXG5cbiAgLyoqXG4gICAqIFRoZSBgaGFyZHdhcmVBY2NlbGVyYXRlZGAgcHJvcCBjb250cm9scyB3aGV0aGVyIHRvIGZvcmNlIGhhcmR3YXJlXG4gICAqIGFjY2VsZXJhdGlvbiBmb3IgdGhlIHVuZGVybHlpbmcgd2luZG93LlxuICAgKlxuICAgKiBUaGlzIHByb3Agd29ya3Mgb25seSBvbiBBbmRyb2lkLlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9tb2RhbCNoYXJkd2FyZWFjY2VsZXJhdGVkXG4gICAqL1xuICBoYXJkd2FyZUFjY2VsZXJhdGVkPzogP2Jvb2xlYW4sXG5cbiAgLyoqXG4gICAqIFRoZSBgdmlzaWJsZWAgcHJvcCBkZXRlcm1pbmVzIHdoZXRoZXIgeW91ciBtb2RhbCBpcyB2aXNpYmxlLlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9tb2RhbCN2aXNpYmxlXG4gICAqL1xuICB2aXNpYmxlPzogP2Jvb2xlYW4sXG5cbiAgLyoqXG4gICAqIFRoZSBgb25SZXF1ZXN0Q2xvc2VgIGNhbGxiYWNrIGlzIGNhbGxlZCB3aGVuIHRoZSB1c2VyIHRhcHMgdGhlIGhhcmR3YXJlXG4gICAqIGJhY2sgYnV0dG9uIG9uIEFuZHJvaWQgb3IgdGhlIG1lbnUgYnV0dG9uIG9uIEFwcGxlIFRWLlxuICAgKlxuICAgKiBUaGlzIGlzIHJlcXVpcmVkIG9uIEFwcGxlIFRWIGFuZCBBbmRyb2lkLlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9tb2RhbCNvbnJlcXVlc3RjbG9zZVxuICAgKi9cbiAgb25SZXF1ZXN0Q2xvc2U/OiA/RGlyZWN0RXZlbnRIYW5kbGVyPG51bGw+LFxuXG4gIC8qKlxuICAgKiBUaGUgYG9uU2hvd2AgcHJvcCBhbGxvd3MgcGFzc2luZyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgb25jZSB0aGVcbiAgICogbW9kYWwgaGFzIGJlZW4gc2hvd24uXG4gICAqXG4gICAqIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL21vZGFsI29uc2hvd1xuICAgKi9cbiAgb25TaG93PzogP0RpcmVjdEV2ZW50SGFuZGxlcjxudWxsPixcblxuICAvKipcbiAgICogVGhlIGBvbkRpc21pc3NgIHByb3AgYWxsb3dzIHBhc3NpbmcgYSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgY2FsbGVkIG9uY2VcbiAgICogdGhlIG1vZGFsIGhhcyBiZWVuIGRpc21pc3NlZC5cbiAgICpcbiAgICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvbW9kYWwjb25kaXNtaXNzXG4gICAqL1xuICBvbkRpc21pc3M/OiA/KCkgPT4gbWl4ZWQsXG5cbiAgLyoqXG4gICAqIFRoZSBgc3VwcG9ydGVkT3JpZW50YXRpb25zYCBwcm9wIGFsbG93cyB0aGUgbW9kYWwgdG8gYmUgcm90YXRlZCB0byBhbnkgb2YgdGhlIHNwZWNpZmllZCBvcmllbnRhdGlvbnMuXG4gICAqXG4gICAqIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL21vZGFsI3N1cHBvcnRlZG9yaWVudGF0aW9uc1xuICAgKi9cbiAgc3VwcG9ydGVkT3JpZW50YXRpb25zPzogPyRSZWFkT25seUFycmF5PFxuICAgIHwgJ3BvcnRyYWl0J1xuICAgIHwgJ3BvcnRyYWl0LXVwc2lkZS1kb3duJ1xuICAgIHwgJ2xhbmRzY2FwZSdcbiAgICB8ICdsYW5kc2NhcGUtbGVmdCdcbiAgICB8ICdsYW5kc2NhcGUtcmlnaHQnLFxuICA+LFxuXG4gIC8qKlxuICAgKiBUaGUgYG9uT3JpZW50YXRpb25DaGFuZ2VgIGNhbGxiYWNrIGlzIGNhbGxlZCB3aGVuIHRoZSBvcmllbnRhdGlvbiBjaGFuZ2VzIHdoaWxlIHRoZSBtb2RhbCBpcyBiZWluZyBkaXNwbGF5ZWQuXG4gICAqXG4gICAqIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL21vZGFsI29ub3JpZW50YXRpb25jaGFuZ2VcbiAgICovXG4gIG9uT3JpZW50YXRpb25DaGFuZ2U/OiA/RGlyZWN0RXZlbnRIYW5kbGVyPE9yaWVudGF0aW9uQ2hhbmdlRXZlbnQ+LFxufH0+O1xuXG5mdW5jdGlvbiBjb25maXJtUHJvcHMocHJvcHM6IFByb3BzKSB7XG4gIGlmIChfX0RFVl9fKSB7XG4gICAgaWYgKFxuICAgICAgcHJvcHMucHJlc2VudGF0aW9uU3R5bGUgJiZcbiAgICAgIHByb3BzLnByZXNlbnRhdGlvblN0eWxlICE9PSAnb3ZlckZ1bGxTY3JlZW4nICYmXG4gICAgICBwcm9wcy50cmFuc3BhcmVudCA9PT0gdHJ1ZVxuICAgICkge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBgTW9kYWwgd2l0aCAnJHtwcm9wcy5wcmVzZW50YXRpb25TdHlsZX0nIHByZXNlbnRhdGlvbiBzdHlsZSBhbmQgJ3RyYW5zcGFyZW50JyB2YWx1ZSBpcyBub3Qgc3VwcG9ydGVkLmAsXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuXG5jbGFzcyBNb2RhbCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcz4ge1xuICBzdGF0aWMgZGVmYXVsdFByb3BzOiB7fGhhcmR3YXJlQWNjZWxlcmF0ZWQ6IGJvb2xlYW4sIHZpc2libGU6IGJvb2xlYW58fSA9IHtcbiAgICB2aXNpYmxlOiB0cnVlLFxuICAgIGhhcmR3YXJlQWNjZWxlcmF0ZWQ6IGZhbHNlLFxuICB9O1xuXG4gIHN0YXRpYyBjb250ZXh0VHlwZTogUmVhY3QuQ29udGV4dDxSb290VGFnPiA9IFJvb3RUYWdDb250ZXh0O1xuXG4gIF9pZGVudGlmaWVyOiBudW1iZXI7XG4gIF9ldmVudFN1YnNjcmlwdGlvbjogP0V2ZW50U3Vic2NyaXB0aW9uO1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzOiBQcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgY29uZmlybVByb3BzKHByb3BzKTtcbiAgICB9XG4gICAgdGhpcy5faWRlbnRpZmllciA9IHVuaXF1ZU1vZGFsSWRlbnRpZmllcisrO1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgLy8gJ21vZGFsRGlzbWlzc2VkJyBpcyBmb3IgdGhlIG9sZCByZW5kZXJlciBpbiBpT1Mgb25seVxuICAgIGlmIChNb2RhbEV2ZW50RW1pdHRlcikge1xuICAgICAgdGhpcy5fZXZlbnRTdWJzY3JpcHRpb24gPSBNb2RhbEV2ZW50RW1pdHRlci5hZGRMaXN0ZW5lcihcbiAgICAgICAgJ21vZGFsRGlzbWlzc2VkJyxcbiAgICAgICAgZXZlbnQgPT4ge1xuICAgICAgICAgIGlmIChldmVudC5tb2RhbElEID09PSB0aGlzLl9pZGVudGlmaWVyICYmIHRoaXMucHJvcHMub25EaXNtaXNzKSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLm9uRGlzbWlzcygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgaWYgKHRoaXMuX2V2ZW50U3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLl9ldmVudFN1YnNjcmlwdGlvbi5yZW1vdmUoKTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIGNvbmZpcm1Qcm9wcyh0aGlzLnByb3BzKTtcbiAgICB9XG4gIH1cblxuICByZW5kZXIoKTogUmVhY3QuTm9kZSB7XG4gICAgaWYgKHRoaXMucHJvcHMudmlzaWJsZSAhPT0gdHJ1ZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgY29udGFpbmVyU3R5bGVzID0ge1xuICAgICAgYmFja2dyb3VuZENvbG9yOlxuICAgICAgICB0aGlzLnByb3BzLnRyYW5zcGFyZW50ID09PSB0cnVlID8gJ3RyYW5zcGFyZW50JyA6ICd3aGl0ZScsXG4gICAgfTtcblxuICAgIGxldCBhbmltYXRpb25UeXBlID0gdGhpcy5wcm9wcy5hbmltYXRpb25UeXBlIHx8ICdub25lJztcblxuICAgIGxldCBwcmVzZW50YXRpb25TdHlsZSA9IHRoaXMucHJvcHMucHJlc2VudGF0aW9uU3R5bGU7XG4gICAgaWYgKCFwcmVzZW50YXRpb25TdHlsZSkge1xuICAgICAgcHJlc2VudGF0aW9uU3R5bGUgPSAnZnVsbFNjcmVlbic7XG4gICAgICBpZiAodGhpcy5wcm9wcy50cmFuc3BhcmVudCA9PT0gdHJ1ZSkge1xuICAgICAgICBwcmVzZW50YXRpb25TdHlsZSA9ICdvdmVyRnVsbFNjcmVlbic7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgaW5uZXJDaGlsZHJlbiA9IF9fREVWX18gPyAoXG4gICAgICA8QXBwQ29udGFpbmVyIHJvb3RUYWc9e3RoaXMuY29udGV4dH0+e3RoaXMucHJvcHMuY2hpbGRyZW59PC9BcHBDb250YWluZXI+XG4gICAgKSA6IChcbiAgICAgIHRoaXMucHJvcHMuY2hpbGRyZW5cbiAgICApO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxSQ1RNb2RhbEhvc3RWaWV3XG4gICAgICAgIGFuaW1hdGlvblR5cGU9e2FuaW1hdGlvblR5cGV9XG4gICAgICAgIHByZXNlbnRhdGlvblN0eWxlPXtwcmVzZW50YXRpb25TdHlsZX1cbiAgICAgICAgdHJhbnNwYXJlbnQ9e3RoaXMucHJvcHMudHJhbnNwYXJlbnR9XG4gICAgICAgIGhhcmR3YXJlQWNjZWxlcmF0ZWQ9e3RoaXMucHJvcHMuaGFyZHdhcmVBY2NlbGVyYXRlZH1cbiAgICAgICAgb25SZXF1ZXN0Q2xvc2U9e3RoaXMucHJvcHMub25SZXF1ZXN0Q2xvc2V9XG4gICAgICAgIG9uU2hvdz17dGhpcy5wcm9wcy5vblNob3d9XG4gICAgICAgIG9uRGlzbWlzcz17KCkgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLnByb3BzLm9uRGlzbWlzcykge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkRpc21pc3MoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH19XG4gICAgICAgIHZpc2libGU9e3RoaXMucHJvcHMudmlzaWJsZX1cbiAgICAgICAgc3RhdHVzQmFyVHJhbnNsdWNlbnQ9e3RoaXMucHJvcHMuc3RhdHVzQmFyVHJhbnNsdWNlbnR9XG4gICAgICAgIGlkZW50aWZpZXI9e3RoaXMuX2lkZW50aWZpZXJ9XG4gICAgICAgIHN0eWxlPXtzdHlsZXMubW9kYWx9XG4gICAgICAgIC8vICRGbG93Rml4TWVbbWV0aG9kLXVuYmluZGluZ10gYWRkZWQgd2hlbiBpbXByb3ZpbmcgdHlwaW5nIGZvciB0aGlzIHBhcmFtZXRlcnNcbiAgICAgICAgb25TdGFydFNob3VsZFNldFJlc3BvbmRlcj17dGhpcy5fc2hvdWxkU2V0UmVzcG9uZGVyfVxuICAgICAgICBzdXBwb3J0ZWRPcmllbnRhdGlvbnM9e3RoaXMucHJvcHMuc3VwcG9ydGVkT3JpZW50YXRpb25zfVxuICAgICAgICBvbk9yaWVudGF0aW9uQ2hhbmdlPXt0aGlzLnByb3BzLm9uT3JpZW50YXRpb25DaGFuZ2V9XG4gICAgICAgIHRlc3RJRD17dGhpcy5wcm9wcy50ZXN0SUR9PlxuICAgICAgICA8VmlydHVhbGl6ZWRMaXN0Q29udGV4dFJlc2V0dGVyPlxuICAgICAgICAgIDxTY3JvbGxWaWV3LkNvbnRleHQuUHJvdmlkZXIgdmFsdWU9e251bGx9PlxuICAgICAgICAgICAgPFZpZXdcbiAgICAgICAgICAgICAgc3R5bGU9e1tzdHlsZXMuY29udGFpbmVyLCBjb250YWluZXJTdHlsZXNdfVxuICAgICAgICAgICAgICBjb2xsYXBzYWJsZT17ZmFsc2V9PlxuICAgICAgICAgICAgICB7aW5uZXJDaGlsZHJlbn1cbiAgICAgICAgICAgIDwvVmlldz5cbiAgICAgICAgICA8L1Njcm9sbFZpZXcuQ29udGV4dC5Qcm92aWRlcj5cbiAgICAgICAgPC9WaXJ0dWFsaXplZExpc3RDb250ZXh0UmVzZXR0ZXI+XG4gICAgICA8L1JDVE1vZGFsSG9zdFZpZXc+XG4gICAgKTtcbiAgfVxuXG4gIC8vIFdlIGRvbid0IHdhbnQgYW55IHJlc3BvbmRlciBldmVudHMgYnViYmxpbmcgb3V0IG9mIHRoZSBtb2RhbC5cbiAgX3Nob3VsZFNldFJlc3BvbmRlcigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuXG5jb25zdCBzaWRlID0gSTE4bk1hbmFnZXIuZ2V0Q29uc3RhbnRzKCkuaXNSVEwgPyAncmlnaHQnIDogJ2xlZnQnO1xuY29uc3Qgc3R5bGVzID0gU3R5bGVTaGVldC5jcmVhdGUoe1xuICBtb2RhbDoge1xuICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICB9LFxuICBjb250YWluZXI6IHtcbiAgICAvKiAkRmxvd0ZpeE1lW2ludmFsaWQtY29tcHV0ZWQtcHJvcF0gKD49MC4xMTEuMCBzaXRlPXJlYWN0X25hdGl2ZV9mYikgVGhpc1xuICAgICAqIGNvbW1lbnQgc3VwcHJlc3NlcyBhbiBlcnJvciBmb3VuZCB3aGVuIEZsb3cgdjAuMTExIHdhcyBkZXBsb3llZC4gVG8gc2VlXG4gICAgICogdGhlIGVycm9yLCBkZWxldGUgdGhpcyBjb21tZW50IGFuZCBydW4gRmxvdy4gKi9cbiAgICBbc2lkZV06IDAsXG4gICAgdG9wOiAwLFxuICAgIGZsZXg6IDEsXG4gIH0sXG59KTtcblxuY29uc3QgRXhwb3J0ZWRNb2RhbDogUmVhY3QuQWJzdHJhY3RDb21wb25lbnQ8XG4gIFJlYWN0LkVsZW1lbnRDb25maWc8dHlwZW9mIE1vZGFsPixcbj4gPSBNb2RhbEluamVjdGlvbi51bnN0YWJsZV9Nb2RhbCA/PyBNb2RhbDtcblxubW9kdWxlLmV4cG9ydHMgPSBFeHBvcnRlZE1vZGFsO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQVlBOztBQUNBOztBQUNBOztBQVVBOztBQUlBOzs7Ozs7OztBQWxCQSxJQUFNQSxZQUFZLEdBQUdDLE9BQU8sQ0FBQyw2QkFBRCxDQUE1Qjs7QUFDQSxJQUFNQyxXQUFXLEdBQUdELE9BQU8sQ0FBQyw0QkFBRCxDQUEzQjs7QUFJQSxJQUFNRSxRQUFRLEdBQUdGLE9BQU8sQ0FBQyx1QkFBRCxDQUF4Qjs7QUFDQSxJQUFNRyxLQUFLLEdBQUdILE9BQU8sQ0FBQyxPQUFELENBQXJCOztBQUNBLElBQU1JLFVBQVUsR0FBR0osT0FBTyxDQUFDLHFDQUFELENBQTFCOztBQUNBLElBQU1LLFVBQVUsR0FBR0wsT0FBTyxDQUFDLDBCQUFELENBQTFCOztBQUNBLElBQU1NLElBQUksR0FBR04sT0FBTyxDQUFDLHlCQUFELENBQXBCOztBQUVBLGVBQXlCQSxPQUFPLENBQUMsd0JBQUQsQ0FBaEM7QUFBQSxJQUFPTyxjQUFQLFlBQU9BLGNBQVA7O0FBYUEsSUFBTUMsaUJBQWlCLEdBQ3JCTixRQUFRLENBQUNPLEVBQVQsS0FBZ0IsS0FBaEIsSUFBeUJDLDJCQUFBLElBQXNCLElB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